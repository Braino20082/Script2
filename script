-- SERVER SCRIPT - F√ºge dieses Script in ServerScriptService ein
-- Name: "ToolGiverServer"

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ServerStorage = game:GetService("ServerStorage")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")

print("Tool Giver Server Script wird geladen...")

-- Remote Events erstellen
local remoteEvents = Instance.new("Folder")
remoteEvents.Name = "ToolGiverRemotes"
remoteEvents.Parent = ReplicatedStorage

local getToolsRemote = Instance.new("RemoteEvent")
getToolsRemote.Name = "GetToolsRemote"
getToolsRemote.Parent = remoteEvents

local giveToolRemote = Instance.new("RemoteEvent")
giveToolRemote.Name = "GiveToolRemote"
giveToolRemote.Parent = remoteEvents

-- Server Tool-Datenbank
local serverTools = {}

-- Funktion zum Scannen der Server-Tools
local function scanServerTools()
    serverTools = {}
    print("Scanne Server nach Tools...")
    
    local function findToolsInContainer(container, containerName)
        local function searchRecursive(obj)
            pcall(function()
                if obj:IsA("Tool") then
                    table.insert(serverTools, {
                        name = obj.Name,
                        path = containerName,
                        originalTool = obj
                    })
                    print("Tool gefunden: " .. obj.Name .. " in " .. containerName)
                end
                
                for _, child in pairs(obj:GetChildren()) do
                    searchRecursive(child)
                end
            end)
        end
        
        pcall(function()
            searchRecursive(container)
        end)
    end
    
    -- Scanne alle Container
    findToolsInContainer(ServerStorage, "ServerStorage")
    findToolsInContainer(ReplicatedStorage, "ReplicatedStorage")
    findToolsInContainer(Lighting, "Lighting")
    findToolsInContainer(Workspace, "Workspace")
    
    -- Entferne Duplikate
    local uniqueTools = {}
    local seen = {}
    
    for _, toolData in pairs(serverTools) do
        local key = toolData.name .. "|" .. toolData.path
        if not seen[key] then
            seen[key] = true
            table.insert(uniqueTools, toolData)
        end
    end
    
    serverTools = uniqueTools
    
    -- Sortiere alphabetisch
    table.sort(serverTools, function(a, b)
        return a.name < b.name
    end)
    
    print("Server-Scan abgeschlossen: " .. #serverTools .. " einzigartige Tools gefunden")
end

-- Event Handler: Client fragt Tool-Liste an
getToolsRemote.OnServerEvent:Connect(function(player)
    print(player.Name .. " fragt Tool-Liste an")
    
    -- Scanne bei jeder Anfrage neu f√ºr aktuelle Tools
    scanServerTools()
    
    -- Sende Tool-Liste zur√ºck
    local toolList = {}
    for _, toolData in pairs(serverTools) do
        table.insert(toolList, {
            name = toolData.name,
            path = toolData.path
        })
    end
    
    -- Sende Antwort zur√ºck an den anfragenden Client
    getToolsRemote:FireClient(player, toolList)
end)

-- Event Handler: Client m√∂chte Tool
giveToolRemote.OnServerEvent:Connect(function(player, toolName)
    print(player.Name .. " m√∂chte Tool: " .. toolName)
    
    -- √úberpr√ºfe ob Spieler g√ºltig ist
    if not player or not player.Parent then
        return
    end
    
    -- Finde das Tool
    local toolToGive = nil
    for _, toolData in pairs(serverTools) do
        if toolData.name == toolName then
            toolToGive = toolData.originalTool
            break
        end
    end
    
    if toolToGive and toolToGive.Parent then
        -- Klone und gib Tool
        pcall(function()
            local clonedTool = toolToGive:Clone()
            clonedTool.Parent = player.Backpack
            print("‚úÖ " .. player.Name .. " hat Tool erhalten: " .. toolName)
        end)
    else
        warn("‚ùå Tool nicht gefunden: " .. toolName)
    end
end)

-- Erstelle einige Beispiel-Tools falls keine vorhanden sind
local function createExampleTools()
    local exampleTools = {"Sword", "Gun", "Hammer", "Flashlight", "Binoculars"}
    
    for _, toolName in pairs(exampleTools) do
        if not ReplicatedStorage:FindFirstChild(toolName) then
            local tool = Instance.new("Tool")
            tool.Name = toolName
            tool.RequiresHandle = true
            
            local handle = Instance.new("Part")
            handle.Name = "Handle"
            handle.Size = Vector3.new(1, 4, 0.5)
            handle.Material = Enum.Material.Neon
            handle.BrickColor = BrickColor.Random()
            handle.CanCollide = false
            handle.Parent = tool
            
            tool.Parent = ReplicatedStorage
            print("Beispiel-Tool erstellt: " .. toolName)
        end
    end
end

-- Starte System
wait(2) -- Warte bis alles geladen ist
createExampleTools()
scanServerTools()

print("üöÄ Tool Giver Server erfolgreich gestartet!")

-- ============================================================================
-- CLIENT SCRIPT - F√ºge dieses in StarterPlayer > StarterPlayerScripts ein
-- Name: "ToolGiverClient"
-- ============================================================================

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

print("Tool Giver Client wird geladen...")

-- Warte auf Remote Events vom Server
local remoteEvents = ReplicatedStorage:WaitForChild("ToolGiverRemotes", 10)
if not remoteEvents then
    warn("‚ùå ToolGiverRemotes nicht gefunden! Stelle sicher, dass das Server-Script l√§uft.")
    return
end

local getToolsRemote = remoteEvents:WaitForChild("GetToolsRemote", 5)
local giveToolRemote = remoteEvents:WaitForChild("GiveToolRemote", 5)

if not getToolsRemote or not giveToolRemote then
    warn("‚ùå Remote Events nicht gefunden!")
    return
end

-- GUI erstellen
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ToolGiverGUI"
screenGui.Parent = playerGui
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Hauptframe
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 550)
mainFrame.Position = UDim2.new(0.5, -225, 0.5, -275)
mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Styling
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 15)
mainCorner.Parent = mainFrame

local shadow = Instance.new("Frame")
shadow.Name = "Shadow"
shadow.Size = UDim2.new(1, 6, 1, 6)
shadow.Position = UDim2.new(0, -3, 0, 3)
shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
shadow.BackgroundTransparency = 0.7
shadow.ZIndex = mainFrame.ZIndex - 1
shadow.Parent = mainFrame

local shadowCorner = Instance.new("UICorner")
shadowCorner.CornerRadius = UDim.new(0, 15)
shadowCorner.Parent = shadow

-- Titel Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 60)
titleBar.BackgroundColor3 = Color3.fromRGB(65, 105, 255)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 15)
titleCorner.Parent = titleBar

local titleFix = Instance.new("Frame")
titleFix.Size = UDim2.new(1, 0, 0, 15)
titleFix.Position = UDim2.new(0, 0, 1, -15)
titleFix.BackgroundColor3 = Color3.fromRGB(65, 105, 255)
titleFix.BorderSizePixel = 0
titleFix.Parent = titleBar

-- Titel
local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(1, -100, 1, 0)
titleText.Position = UDim2.new(0, 10, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "üåê Server Tool Giver"
titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
titleText.TextScaled = true
titleText.Font = Enum.Font.GothamBold
titleText.Parent = titleBar

-- Refresh Button
local refreshButton = Instance.new("TextButton")
refreshButton.Size = UDim2.new(0, 40, 0, 40)
refreshButton.Position = UDim2.new(1, -95, 0, 10)
refreshButton.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
refreshButton.Text = "üîÑ"
refreshButton.TextColor3 = Color3.fromRGB(255, 255, 255)
refreshButton.TextScaled = true
refreshButton.Font = Enum.Font.GothamBold
refreshButton.BorderSizePixel = 0
refreshButton.Parent = titleBar

local refreshCorner = Instance.new("UICorner")
refreshCorner.CornerRadius = UDim.new(0, 8)
refreshCorner.Parent = refreshButton

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 40, 0, 40)
closeButton.Position = UDim2.new(1, -50, 0, 10)
closeButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
closeButton.Text = "‚úï"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.TextScaled = true
closeButton.Font = Enum.Font.GothamBold
closeButton.BorderSizePixel = 0
closeButton.Parent = titleBar

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(0, 8)
closeCorner.Parent = closeButton

-- Status Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 25)
statusLabel.Position = UDim2.new(0, 10, 0, 65)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Verbinde mit Server..."
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.TextScaled = true
statusLabel.Font = Enum.Font.Gotham
statusLabel.Parent = mainFrame

-- Scroll Frame
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -20, 1, -170)
scrollFrame.Position = UDim2.new(0, 10, 0, 95)
scrollFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 8
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(65, 105, 255)
scrollFrame.Parent = mainFrame

local scrollCorner = Instance.new("UICorner")
scrollCorner.CornerRadius = UDim.new(0, 10)
scrollCorner.Parent = scrollFrame

-- Layout
local listLayout = Instance.new("UIListLayout")
listLayout.SortOrder = Enum.SortOrder.Name
listLayout.Padding = UDim.new(0, 5)
listLayout.Parent = scrollFrame

local listPadding = Instance.new("UIPadding")
listPadding.PaddingTop = UDim.new(0, 10)
listPadding.PaddingBottom = UDim.new(0, 10)
listPadding.PaddingLeft = UDim.new(0, 10)
listPadding.PaddingRight = UDim.new(0, 10)
listPadding.Parent = scrollFrame

-- Search Box
local searchFrame = Instance.new("Frame")
searchFrame.Size = UDim2.new(1, -20, 0, 40)
searchFrame.Position = UDim2.new(0, 10, 1, -50)
searchFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
searchFrame.BorderSizePixel = 0
searchFrame.Parent = mainFrame

local searchCorner = Instance.new("UICorner")
searchCorner.CornerRadius = UDim.new(0, 8)
searchCorner.Parent = searchFrame

local searchBox = Instance.new("TextBox")
searchBox.Size = UDim2.new(1, -20, 1, 0)
searchBox.Position = UDim2.new(0, 10, 0, 0)
searchBox.BackgroundTransparency = 1
searchBox.Text = ""
searchBox.PlaceholderText = "üîç Server-Tool suchen..."
searchBox.TextColor3 = Color3.fromRGB(255, 255, 255)
searchBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
searchBox.TextScaled = true
searchBox.Font = Enum.Font.Gotham
searchBox.Parent = searchFrame

-- Variablen
local serverTools = {}
local toolButtons = {}

-- Tool Button erstellen
local function createToolButton(toolData)
    local toolButton = Instance.new("TextButton")
    toolButton.Name = toolData.name .. "Button"
    toolButton.Size = UDim2.new(1, 0, 0, 50)
    toolButton.BackgroundColor3 = Color3.fromRGB(55, 55, 65)
    toolButton.BorderSizePixel = 0
    toolButton.Parent = scrollFrame
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 8)
    buttonCorner.Parent = toolButton
    
    -- Tool Name
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, -60, 0.6, 0)
    nameLabel.Position = UDim2.new(0, 10, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = "üîß " .. toolData.name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextScaled = true
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Parent = toolButton
    
    -- Tool Path
    local pathLabel = Instance.new("TextLabel")
    pathLabel.Size = UDim2.new(1, -60, 0.4, 0)
    pathLabel.Position = UDim2.new(0, 10, 0.6, 0)
    pathLabel.BackgroundTransparency = 1
    pathLabel.Text = "üåê " .. toolData.path
    pathLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    pathLabel.TextXAlignment = Enum.TextXAlignment.Left
    pathLabel.TextScaled = true
    pathLabel.Font = Enum.Font.Gotham
    pathLabel.Parent = toolButton
    
    -- Get Button
    local getButton = Instance.new("TextButton")
    getButton.Size = UDim2.new(0, 45, 0, 30)
    getButton.Position = UDim2.new(1, -55, 0.5, -15)
    getButton.BackgroundColor3 = Color3.fromRGB(65, 105, 255)
    getButton.Text = "GET"
    getButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    getButton.TextScaled = true
    getButton.Font = Enum.Font.GothamBold
    getButton.BorderSizePixel = 0
    getButton.Parent = toolButton
    
    local getCorner = Instance.new("UICorner")
    getCorner.CornerRadius = UDim.new(0, 6)
    getCorner.Parent = getButton
    
    -- Hover-Effekte
    toolButton.MouseEnter:Connect(function()
        TweenService:Create(toolButton, TweenInfo.new(0.2), 
            {BackgroundColor3 = Color3.fromRGB(65, 65, 75)}):Play()
    end)
    
    toolButton.MouseLeave:Connect(function()
        TweenService:Create(toolButton, TweenInfo.new(0.2), 
            {BackgroundColor3 = Color3.fromRGB(55, 55, 65)}):Play()
    end)
    
    -- Tool anfordern
    local function requestTool()
        getButton.Text = "..."
        getButton.BackgroundColor3 = Color3.fromRGB(255, 165, 0)
        
        -- Sende Anfrage an Server
        giveToolRemote:FireServer(toolData.name)
        
        -- Feedback
        spawn(function()
            wait(0.5)
            getButton.Text = "‚úì"
            getButton.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
            wait(1.5)
            getButton.Text = "GET"
            getButton.BackgroundColor3 = Color3.fromRGB(65, 105, 255)
        end)
    end
    
    getButton.MouseButton1Click:Connect(requestTool)
    toolButton.MouseButton1Click:Connect(requestTool)
    
    return toolButton
end

-- Tools vom Server laden
local function loadServerTools()
    statusLabel.Text = "Lade Tools vom Server..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    
    -- L√∂sche alte Buttons
    for _, button in pairs(toolButtons) do
        if button and button.Parent then
            button:Destroy()
        end
    end
    toolButtons = {}
    
    -- Anfrage an Server senden
    getToolsRemote:FireServer()
end

-- Server Antwort empfangen
getToolsRemote.OnClientEvent:Connect(function(tools)
    print("Tools vom Server empfangen: " .. #tools)
    
    serverTools = tools
    
    if #serverTools == 0 then
        statusLabel.Text = "‚ùå Keine Tools auf Server"
        statusLabel.TextColor3 = Color3.fromRGB(255, 85, 85)
    else
        statusLabel.Text = "‚úÖ " .. #serverTools .. " Server-Tools geladen"
        statusLabel.TextColor3 = Color3.fromRGB(85, 255, 85)
        
        -- Erstelle Buttons
        for _, toolData in pairs(serverTools) do
            toolButtons[toolData.name] = createToolButton(toolData)
        end
        
        scrollFrame.CanvasSize = UDim2.new(0, 0, 0, #serverTools * 55 + 20)
    end
end)

-- Such-Funktion
searchBox.Changed:Connect(function()
    local searchText = searchBox.Text:lower()
    local visibleCount = 0
    
    for toolName, button in pairs(toolButtons) do
        if toolName:lower():find(searchText) or searchText == "" then
            button.Visible = true
            visibleCount = visibleCount + 1
        else
            button.Visible = false
        end
    end
    
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, visibleCount * 55 + 20)
end)

-- Button Events
refreshButton.MouseButton1Click:Connect(function()
    TweenService:Create(refreshButton, TweenInfo.new(0.5), 
        {Rotation = refreshButton.Rotation + 360}):Play()
    loadServerTools()
end)

closeButton.MouseButton1Click:Connect(function()
    local tween = TweenService:Create(mainFrame, 
        TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), 
        {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)})
    tween:Play()
    tween.Completed:Connect(function()
        screenGui:Destroy()
    end)
end)

-- Dragging
local dragToggle, dragStart, startPos = nil, nil, nil

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragToggle = true
        dragStart = input.Position
        startPos = mainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragToggle = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement and dragToggle then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, 
                                      startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- √ñffnungs-Animation
mainFrame.Size = UDim2.new(0, 0, 0, 0)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)

TweenService:Create(mainFrame, 
    TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), 
    {Size = UDim2.new(0, 450, 0, 550), Position = UDim2.new(0.5, -225, 0.5, -275)}):Play()

-- Automatisch laden
wait(2)
loadServerTools()

print("‚úÖ Tool Giver Client erfolgreich geladen!")
