-- ======= CONFIG =======
local NPCs = workspace.NPCs:GetChildren() -- Alle NPCs im Spiel
local SHOP_ITEMS = {
    {Name = "Sword", Price = 100},
    {Name = "Shield", Price = 150},
    {Name = "Potion", Price = 50}
}
local CURRENCY = "Coins" -- Name der Spieler-Währung

-- ======= HELPER FUNCTIONS =======
-- Prüft, ob der Spieler genug Geld hat
local function canAfford(player, amount)
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats and leaderstats:FindFirstChild(CURRENCY) then
        return leaderstats[CURRENCY].Value >= amount
    end
    return false
end

-- Zieht Geld vom Spieler ab
local function deductMoney(player, amount)
    local leaderstats = player:FindFirstChild("leaderstats")
    if leaderstats and leaderstats:FindFirstChild(CURRENCY) then
        leaderstats[CURRENCY].Value -= amount
    end
end

-- Sendet eine Nachricht an den Spieler
local function notifyPlayer(player, message)
    player:SendNotification({
        Title = "Shop",
        Text = message,
        Duration = 3
    })
end

-- ======= SHOP LOGIK =======
local function handlePurchase(player, item)
    if canAfford(player, item.Price) then
        deductMoney(player, item.Price)
        -- Hier Item geben (z.B. ins Inventory)
        notifyPlayer(player, "Du hast " .. item.Name .. " gekauft!")
    else
        notifyPlayer(player, "Du hast nicht genug Coins!")
    end
end

-- ======= NPC INTERAKTION =======
for _, npc in pairs(NPCs) do
    if npc:IsA("Model") and npc:FindFirstChild("ClickDetector") then
        npc.ClickDetector.MouseClick:Connect(function(player)
            -- Einfaches GUI-Dialog-System
            for _, item in pairs(SHOP_ITEMS) do
                -- Beispiel: Sofortkauf (du kannst hier GUI-Integration machen)
                handlePurchase(player, item)
            end
        end)
    end
end
