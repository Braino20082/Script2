-- ServerScriptService/GetAllToolsButton.lua
-- Ein Button: beim Klick bekommt der Spieler alle Tools aus ServerStorage/Tools

local Players = game:GetService("Players")
local ServerStorage = game:GetService("ServerStorage")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Tools-Ordner prüfen oder erstellen
local toolsFolder = ServerStorage:FindFirstChild("Tools")
if not toolsFolder then
    toolsFolder = Instance.new("Folder")
    toolsFolder.Name = "Tools"
    toolsFolder.Parent = ServerStorage
    warn("ServerStorage/Tools erstellt. Lege dort deine Tools ab.")
end

-- RemoteEvent für Button-Click
local ToolRequest = ReplicatedStorage:FindFirstChild("ToolRequest")
if not ToolRequest then
    ToolRequest = Instance.new("RemoteEvent")
    ToolRequest.Name = "ToolRequest"
    ToolRequest.Parent = ReplicatedStorage
end

-- Server empfängt Click und gibt alle Tools
ToolRequest.OnServerEvent:Connect(function(player)
    local backpack = player:FindFirstChildOfClass("Backpack")
    if not backpack then return end
    for _, tool in pairs(toolsFolder:GetChildren()) do
        if tool:IsA("Tool") then
            local existing = backpack:FindFirstChild(tool.Name)
            if existing then existing:Destroy() end
            tool:Clone().Parent = backpack
        end
    end
end)

-- LocalScript GUI-Code für den Spieler
local localScriptSource = [[
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = game.Players.LocalPlayer
local ToolRequest = ReplicatedStorage:WaitForChild("ToolRequest")

-- GUI erstellen
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GetAllToolsGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,200,0,100)
frame.Position = UDim2.new(0,20,0,50)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
frame.Parent = screenGui

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0,180,0,50)
btn.Position = UDim2.new(0,10,0,25)
btn.Text = "Alle Tools bekommen"
btn.Font = Enum.Font.SourceSansBold
btn.TextSize = 18
btn.TextColor3 = Color3.new(1,1,1)
btn.Parent = frame

btn.MouseButton1Click:Connect(function()
    ToolRequest:FireServer()
end)
]]

-- LocalScript an Spieler deployen
local function deployLocalScript(player)
    local pg = player:WaitForChild("PlayerGui")
    if pg:FindFirstChild("GetAllToolsGUI") then pg.GetAllToolsGUI:Destroy() end
    local ls = Instance.new("LocalScript")
    ls.Name = "GetAllToolsClient"
    ls.Source = localScriptSource
    ls.Parent = pg
end

-- Spieler joinet
Players.PlayerAdded:Connect(function(player)
    deployLocalScript(player)
end)

-- Bereits im Spiel
for _, p in pairs(Players:GetPlayers()) do
    deployLocalScript(p)
end

print("GetAllToolsButton Script läuft – ein Klick = alle Tools!")
